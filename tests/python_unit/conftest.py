import pytest


@pytest.fixture
def make_list_operator_name():
    def _make_list_operator_name():
        return ["sh-id", "sh-sp", "sh-sm", "sh-sx", "sh-sz"], ["sh-id-cplx", "sh-sy"]

    return _make_list_operator_name


@pytest.fixture
def make_list_real_operator_name(make_list_operator_name):
    return make_list_operator_name()[0]


@pytest.fixture
def make_list_cplx_operator_name(make_list_operator_name):
    return make_list_operator_name()[1]


@pytest.fixture
def make_gate():
    from numpy import array

    old_theta = {
        (0, 0, 0, 0): array([[[[0.99483226]]]]),
        (0, 0, 1, 1): array([[[[0.99226175, 0.0], [0.0, 1.00780536]]]]),
        (0, 0, 2, 2): array([[[[1.00520133]]]]),
        (0, 1, 0, 1): array([[[[-0.00257052, 0.0]], [[0.0, -0.00261078]]]]),
        (0, 1, 1, 2): array([[[[0.0], [-0.00260404]], [[-0.00260404], [0.0]]]]),
        (0, 2, 0, 2): array([[[[6.74591518e-06]]]]),
        (1, 0, 1, 0): array([[[[-0.00257052], [0.0]]], [[[0.0], [-0.00261078]]]]),
        (1, 0, 2, 1): array([[[[0.0, -0.00260404]]], [[[-0.00260404, 0.0]]]]),
        (1, 1, 0, 0): array([[[[0.99226175]], [[0.0]]], [[[0.0]], [[1.00780536]]]]),
        (1, 1, 1, 1): array(
            [
                [
                    [[9.79488739e-01, 0.00000000e00], [0.00000000e00, 1.00520133e00]],
                    [[0.00000000e00, 6.74591518e-06], [0.00000000e00, 0.00000000e00]],
                ],
                [
                    [[0.00000000e00, 0.00000000e00], [6.74591518e-06, 0.00000000e00]],
                    [[1.00520133e00, 0.00000000e00], [0.00000000e00, 1.01041614e00]],
                ],
            ]
        ),
        (1, 1, 2, 2): array([[[[0.99226175]], [[0.0]]], [[[0.0]], [[1.00780536]]]]),
        (1, 2, 0, 1): array([[[[0.0, -0.00260404]]], [[[-0.00260404, 0.0]]]]),
        (1, 2, 1, 2): array([[[[-0.00257052], [0.0]]], [[[0.0], [-0.00261078]]]]),
        (2, 0, 2, 0): array([[[[6.74591518e-06]]]]),
        (2, 1, 1, 0): array([[[[0.0], [-0.00260404]], [[-0.00260404], [0.0]]]]),
        (2, 1, 2, 1): array([[[[-0.00257052, 0.0]], [[0.0, -0.00261078]]]]),
        (2, 2, 0, 0): array([[[[1.00520133]]]]),
        (2, 2, 1, 1): array([[[[0.99226175, 0.0], [0.0, 1.00780536]]]]),
        (2, 2, 2, 2): array([[[[0.99483226]]]]),
    }

    new_theta = {
        (0, 0, 0, 0): array([[[[0.99483226]]]]),
        (0, 0, 1, 1): array([[[[1.00780536, 0.0], [0.0, 0.99226175]]]]),
        (0, 0, 2, 2): array([[[[1.00520133]]]]),
        (0, 1, 0, 1): array([[[[-0.00261078, 0.0]], [[0.0, -0.00257052]]]]),
        (0, 1, 1, 2): array([[[[0.0], [-0.00260404]], [[-0.00260404], [0.0]]]]),
        (0, 2, 0, 2): array([[[[6.74591518e-06]]]]),
        (1, 0, 1, 0): array([[[[-0.00261078], [0.0]]], [[[0.0], [-0.00257052]]]]),
        (1, 0, 2, 1): array([[[[0.0, -0.00260404]]], [[[-0.00260404, 0.0]]]]),
        (1, 1, 0, 0): array([[[[1.00780536]], [[0.0]]], [[[0.0]], [[0.99226175]]]]),
        (1, 1, 1, 1): array(
            [
                [
                    [[1.01041614e00, 0.00000000e00], [0.00000000e00, 1.00520133e00]],
                    [[0.00000000e00, 6.74591518e-06], [0.00000000e00, 0.00000000e00]],
                ],
                [
                    [[0.00000000e00, 0.00000000e00], [6.74591518e-06, 0.00000000e00]],
                    [[1.00520133e00, 0.00000000e00], [0.00000000e00, 9.79488739e-01]],
                ],
            ]
        ),
        (1, 1, 2, 2): array([[[[1.00780536]], [[0.0]]], [[[0.0]], [[0.99226175]]]]),
        (1, 2, 0, 1): array([[[[0.0, -0.00260404]]], [[[-0.00260404, 0.0]]]]),
        (1, 2, 1, 2): array([[[[-0.00261078], [0.0]]], [[[0.0], [-0.00257052]]]]),
        (2, 0, 2, 0): array([[[[6.74591518e-06]]]]),
        (2, 1, 1, 0): array([[[[0.0], [-0.00260404]], [[-0.00260404], [0.0]]]]),
        (2, 1, 2, 1): array([[[[-0.00261078, 0.0]], [[0.0, -0.00257052]]]]),
        (2, 2, 0, 0): array([[[[1.00520133]]]]),
        (2, 2, 1, 1): array([[[[1.00780536, 0.0], [0.0, 0.99226175]]]]),
        (2, 2, 2, 2): array([[[[0.99483226]]]]),
    }

    # from pyfhmdot.initialize import create_hamiltonian_gates

    # new_theta = create_hamiltonian_gates(
    #     "sh_xxz-hz_u1",
    #     {"Jxy": 0.25, "Jz": 0.5, "hz": 1.5},  # 1/4.*1, 1/4.*2, 1/2.*3
    #     4,
    #     dbeta=0.025,
    #     is_dgate=True,
    #     in_group=True,
    # )[0][1]
    # old_theta = {}
    # for key in new_theta:
    #     old_theta[key] = new_theta[key][::-1, ::-1, ::-1, ::-1]

    return lambda: new_theta


@pytest.fixture
def make_random_blocs():
    def create_random_blocs(chi, max_index=3):
        def create_random_matrix(chi, d):
            from numpy.random import random

            return random(chi * d * chi).reshape(chi, d, chi)

        blocs = {}  # sh
        for i in range(max_index):
            for j in range(max_index):
                blocs[(i, 0, j)] = create_random_matrix(chi, d=1)
                blocs[(i, 1, j)] = create_random_matrix(chi, d=2)
                blocs[(i, 2, j)] = create_random_matrix(chi, d=1)
        return blocs

    return create_random_blocs
